
<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>è±è±åƒä»€ä¹ˆ</title>
<style>
body { font-family: "Microsoft YaHei", sans-serif; background: #fff8f0; color: #333; padding: 20px; }
h1 { text-align: center; color: #d84315; }
.section { margin-top: 20px; }
.button-group { display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; }
button { background-color: #ff7043; color: white; border: none; border-radius: 8px; padding: 10px 16px; font-size: 16px; cursor: pointer; }
button.selected { background-color: #d84315; }
.menu-list, .result-list, .history-list { background: #fff; padding: 15px; border-radius: 10px; margin-top: 15px; }
.footer-btn { display: block; width: 100%; background: #d84315; color: white; padding: 12px; font-size: 18px; margin-top: 20px; border: none; border-radius: 10px; }
#popup { position: fixed; top: 10%; left: 10%; right: 10%; background: white; border: 2px solid #ff7043; border-radius: 10px; padding: 20px; display: none; z-index: 1000; }
#popup h3 { color: #d84315; }
.cart { margin-top: 15px; }
</style>
</head>
<body>
<h1>ğŸš è±è±åƒä»€ä¹ˆ</h1>

<div id="modeSelect" class="section">
  <h2>è¯·é€‰æ‹©æ¨¡å¼</h2>
  <div class="button-group">
    <button onclick="selectMode('random')">ğŸ€ éšæœºæ¨èæ¨¡å¼</button>
    <button onclick="selectMode('custom')">ğŸ›’ è‡ªç”±ç»„åˆæ¨¡å¼</button>
  </div>
  <button class="footer-btn" onclick="showHistory()">ğŸ“… æŸ¥çœ‹å†å²è®°å½•</button>
  <button class="footer-btn" onclick="clearHistory()">ğŸ§¹ æ¸…é™¤å†å²è®°å½•</button>
</div>

<div id="randomMode" class="section" style="display:none;">
  <h2>é€‰æ‹©å‡ èœå‡ æ±¤</h2>
  <div class="button-group" id="countGroup">
    <button data-value="3èœ1æ±¤">ä¸‰èœä¸€æ±¤</button>
    <button data-value="4èœ1æ±¤">å››èœä¸€æ±¤</button>
    <button data-value="3èœ0æ±¤">ä¸‰èœæ— æ±¤</button>
    <button data-value="2èœ1æ±¤">ä¸¤èœä¸€æ±¤</button>
  </div>
</div>

<div id="menuContainer" class="section" style="display:none;">
  <h2>ä»Šæ—¥æ¨è</h2>
  <div id="menuList" class="menu-list"></div>
  <button class="footer-btn" onclick="submitMenu()">æäº¤ä»Šæ—¥èœå•</button>
</div>

<div id="customMode" class="section" style="display:none;">
  <h2>è¯·é€‰æ‹©èœå“æ·»åŠ åˆ°è´­ç‰©è½¦</h2>
  <div id="customList" class="menu-list"></div>
  <button class="footer-btn" onclick="viewCart()">ğŸ›’ æŸ¥çœ‹è´­ç‰©è½¦</button>
</div>

<div id="cartContainer" class="section" style="display:none;">
  <h2>è´­ç‰©è½¦</h2>
  <div id="cartList" class="cart"></div>
  <button class="footer-btn" onclick="submitMenu()">æäº¤èœå•</button>
</div>

<div id="historyContainer" class="section" style="display:none;">
  <h2>å†å²èœå•</h2>
  <div id="historyList" class="history-list"></div>
  <button class="footer-btn" onclick="backHome()">è¿”å›é¦–é¡µ</button>
</div>

<div id="popup">
  <h3>ğŸ›’ ä»Šæ—¥å¤‡èœæ¸…å•</h3>
  <div id="popupContent"></div>
  <button class="footer-btn" onclick="closePopup()">å…³é—­</button>
</div>

<script>
const recipes = {
  "è¤èœ": {
    "è¾£æ¤’ç‚’è‚‰": ["äº”èŠ±è‚‰", "é’æ¤’", "è’œ", "é…±æ²¹"],
    "å›é”…è‚‰": ["äº”èŠ±è‚‰", "è±†ç“£é…±", "è’œè‹—"],
    "å•¤é…’é¸­": ["é¸­è‚‰", "å•¤é…’", "å§œ", "è’œ", "è€æŠ½"],
    "é»„ç„–é¸¡": ["é¸¡è…¿è‚‰", "å§œ", "è’œ", "æ–™é…’", "é…±æ²¹"],
    "å‰æ¤’é±¼å¤´": ["é±¼å¤´", "å‰æ¤’", "å§œ", "è’œ"],
    "å­œç„¶ç‰›è‚‰": ["ç‰›è‚‰", "å­œç„¶ç²‰", "æ´‹è‘±"],
    "æ¢…èœæ‰£è‚‰": ["äº”èŠ±è‚‰", "æ¢…å¹²èœ"],
    "éº»è¾£é¦™é”…": ["ç‰›è‚‰ç‰‡", "è²è—•", "é’æ¤’", "è±†çš®"]
  },
  "ç´ èœ": {
    "è¥¿çº¢æŸ¿ç‚’è›‹": ["é¸¡è›‹", "è¥¿çº¢æŸ¿", "ç›"],
    "æ¸…ç‚’æ²¹éº¦èœ": ["æ²¹éº¦èœ", "è’œ"],
    "é¦™å¹²ç‚’èŠ¹èœ": ["èŠ¹èœ", "é¦™å¹²"],
    "å¹²ç…¸è±†è§’": ["è±†è§’", "è¾£æ¤’", "è’œ"],
    "è’œè“‰ç©ºå¿ƒèœ": ["ç©ºå¿ƒèœ", "è’œ"],
    "éº»å©†è±†è…": ["è±†è…", "ç‰›è‚‰æœ«", "è±†ç“£é…±"],
    "ç‚’åœŸè±†ä¸": ["åœŸè±†", "é’æ¤’", "é†‹"]
  },
  "æ±¤": {
    "ç´«èœè›‹æ±¤": ["ç´«èœ", "é¸¡è›‹", "è‘±"],
    "å†¬ç“œæ’éª¨æ±¤": ["å†¬ç“œ", "æ’éª¨", "å§œ"],
    "ç•ªèŒ„è›‹æ±¤": ["è¥¿çº¢æŸ¿", "é¸¡è›‹", "ç›"],
    "é»„è±†çŒªéª¨æ±¤": ["é»„è±†", "çŒªéª¨", "å§œ"],
    "è²è—•èŠ±ç”Ÿæ±¤": ["è²è—•", "èŠ±ç”Ÿ", "æ’éª¨"]
  }
};

let selectedMode = "", selectedCount = "", todayMenu = [], cart = [];

function selectMode(mode) {
  selectedMode = mode;
  document.getElementById("modeSelect").style.display = "none";
  if (mode === "random") document.getElementById("randomMode").style.display = "block";
  else showCustomList();
}

document.querySelectorAll("#countGroup button").forEach(b => {
  b.onclick = () => {
    document.querySelectorAll("#countGroup button").forEach(btn => btn.classList.remove("selected"));
    b.classList.add("selected");
    selectedCount = b.getAttribute("data-value");
    generateRandomMenu();
  };
});

function generateRandomMenu() {
  const [dishCount, soupCount] = selectedCount.match(/(\d)èœ(\d)æ±¤/).slice(1,3).map(Number);
  const meatDishes = Object.keys(recipes["è¤èœ"]);
  const vegDishes = Object.keys(recipes["ç´ èœ"]);
  const soups = Object.keys(recipes["æ±¤"]);
  const lastMenu = JSON.parse(localStorage.getItem("lastMenu") || "[]");

  function pick(arr, n) { return arr.sort(() => 0.5 - Math.random()).slice(0, n); }

  let meats = pick(meatDishes.filter(x => !lastMenu.includes(x)), Math.max(1, Math.floor(dishCount/2)));
  let vegs = pick(vegDishes.filter(x => !lastMenu.includes(x)), dishCount - meats.length);
  let selected = meats.concat(vegs);
  if (soupCount > 0) selected = selected.concat(pick(soups, soupCount));

  todayMenu = selected;
  showMenuList(selected);
}

function showMenuList(list) {
  document.getElementById("randomMode").style.display = "none";
  document.getElementById("menuContainer").style.display = "block";
  document.getElementById("menuList").innerHTML = list.map(d => `<div>âœ… ${d}ï¼ˆ${(recipes["è¤èœ"][d] || recipes["ç´ èœ"][d] || recipes["æ±¤"][d]).join("ã€")}ï¼‰</div>`).join("");
}

function showCustomList() {
  document.getElementById("customMode").style.display = "block";
  let html = "";
  for (let cat in recipes) {
    html += `<h3>${cat}</h3>`;
    for (let dish in recipes[cat]) {
      html += `<div><button onclick="addToCart('${dish}')">${dish}</button> (${recipes[cat][dish].join("ã€")})</div>`;
    }
  }
  document.getElementById("customList").innerHTML = html;
}

function addToCart(dish) {
  if (!cart.includes(dish)) cart.push(dish);
  alert(dish + " å·²åŠ å…¥è´­ç‰©è½¦");
}

function viewCart() {
  document.getElementById("customMode").style.display = "none";
  document.getElementById("cartContainer").style.display = "block";
  document.getElementById("cartList").innerHTML = cart.map(d => `<div>${d} <button onclick="removeFromCart('${d}')">âŒ ç§»é™¤</button></div>`).join("");
}

function removeFromCart(d) {
  cart = cart.filter(x => x !== d);
  viewCart();
}

function submitMenu() {
  const list = selectedMode === "custom" ? cart : todayMenu;
  if (!list || list.length === 0) return alert("è¿˜æ²¡æœ‰é€‰æ‹©èœï¼");
  localStorage.setItem("lastMenu", JSON.stringify(list));
  const history = JSON.parse(localStorage.getItem("history") || "[]");
  history.push({ date: new Date().toLocaleString(), dishes: list });
  localStorage.setItem("history", JSON.stringify(history));

  let html = "<h4>ä»Šæ—¥èœå•ï¼š</h4><ul>";
  html += list.map(d => `<li>${d}</li>`).join("") + "</ul><h4>åŸææ–™ï¼š</h4>";
  list.forEach(d => { let ing = recipes["è¤èœ"][d] || recipes["ç´ èœ"][d] || recipes["æ±¤"][d] || []; html += `${d}ï¼š${ing.join("ã€")}<br>`; });
  document.getElementById("popupContent").innerHTML = html;
  document.getElementById("popup").style.display = "block";
}

function closePopup() { document.getElementById("popup").style.display = "none"; location.reload(); }

function showHistory() {
  document.getElementById("modeSelect").style.display = "none";
  document.getElementById("historyContainer").style.display = "block";
  const history = JSON.parse(localStorage.getItem("history") || "[]");
  if (history.length === 0) { document.getElementById("historyList").innerHTML = "æš‚æ— å†å²è®°å½•"; return; }
  document.getElementById("historyList").innerHTML = history.map(h => `<div>ğŸ“… ${h.date}<br>${h.dishes.join("ã€")}</div><hr>`).join("");
}

function clearHistory() {
  if (confirm("ç¡®å®šæ¸…é™¤å…¨éƒ¨å†å²è®°å½•å—ï¼Ÿ")) {
    localStorage.clear();
    alert("å·²æ¸…é™¤ï¼");
    location.reload();
  }
}

function backHome() { location.reload(); }
</script>
</body>
</html>
